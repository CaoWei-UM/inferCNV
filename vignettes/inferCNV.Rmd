---
title: "Visualizing Large-scale Copy Number Variation in Single-Cell RNA-Seq Expression Data"
author: 
- name: Timothy Tickle
  affiliation: &kco Klarman Cell Observatory, Broad Institute of MIT and Harvard, Cambridge, MA, USA
- name: Itay Tirosh
  affiliation: 
    - *kco
    - Weizmann Institute of Science, Rehovot, Israel
- name: Brian Haas
  affiliation: *kco
output:
  BiocStyle::pdf_document: default
package: inferCNV
abstract: >
  InferCNV is used to explore tumor single cell RNA-Seq data to identify evidence for large-scale chromosomal copy number variations, such as gains or deletions of entire chromosomes or large segments of chromosomes. This is done by exploring expression intensity of genes across positions of the genome in comparison to the average or a set of reference 'normal' cells. A heatmap is generated illustrating the relative expression intensities across each chromosome, and it becomes readily apparent as to which regions of the genome are over-abundant or less-abundant as compared to normal cells (or the average, if reference normal cells are not provided).
vignette: >
  %\VignetteIndexEntry{Visualizing Large-scale Copy Number Variation in Single-Cell RNA-Seq Expression Data}
  %\VignetteEncoding{UTF-8}
  %\VignetteEngine{knitr::rmarkdown}
---


# Installation
## Required dependencies

_inferCNV_ uses the _R_ packages `r CRANpkg("ape")`, `r CRANpkg("RColorBrewer")` and `r CRANpkg("GMD")`

<!--
[https://cran.r-project.org/web/packages/ape/index.html]
[https://cran.r-project.org/web/packages/RColorBrewer/index.html]
[https://cran.r-project.org/src/contrib/Archive/GMD/]
-->


Use the biocLite.R script to install Bioconductor packages. To install core packages, type the following in an R command window:
```{r install, eval = FALSE}
## try http:// if https:// URLs are not supported
source("https://bioconductor.org/biocLite.R")
biocLite("inferCNV")
```

## Optional dependencies
If you want to use the interactive heatmap visualization, please also install the _R_ packages `r CRANpkg("dplyr")`, `r CRANpkg("tibble")`, `r Githubpkg("bmbroom/tsvio")` and `r Githubpkg("bmbroom/NGCHMR")`. To install optional packages, type the following in an R command window:

<!--
[https://cran.r-project.org/web/packages/dplyr/index.html]
[https://cran.r-project.org/web/packages/tibble/index.html]
[https://github.com/bmbroom/tsvio]
[https://github.com/bmbroom/NGCHMR]
-->

```{r install-optionals, eval = FALSE}
install.packages("dplyr")
install.packages("tibble")

install.packages("devtools")
devtools::install_github("bmbroom/tsvio")
devtools::install_github("bmbroom/NGCHMR", ref="stable")

```

And download the NGCHM java application by typing the following in a regular shell:
```{bash, eval = FALSE}
wget http://tcga.ngchm.net/NGCHM/ShaidyMapGen.jar
```




# Copy Number Variation inference

```{r run-infercnv}
library(infercnv)
infercnv(x="../example/oligodendrocytoma_expression_downsampled.txt",
        gene_order="../example/gencode_downsampled.txt", 
        annotations="../example/oligodendrocytoma_annotations_downsampled.txt", 
        cutoff=1, 
        noise_filter=0.2, 
        output_dir="../example_output", 
        name_ref_groups="Microglia/Macrophage,Oligodendrocytes (non-malignant)", 
        hclust_method="ward.D",
        log_level="WARNING",
        output_format="png")


```

![infercnv output](../example_output/infercnv.png)



# Session info

```{r sessioninfo, echo=FALSE, tidy=TRUE, tidy.opts=list()}
sessionInfo()
```

